<!-- Shop deatil Start -->
{{!-- {{#if authenticated}} --}}
    <div class="container-fluid pb-5">
        <div class="row px-xl-1">
            <div class="col-lg-5 mb-30 ">
                <div class="h-100 bg-light p-100">
                    <div id="product-carousel" class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner bg-light pt-3 ">
                            <div class="carousel-item active">
                                <img class="w-100 h-100" src={{course.image}} alt="Image">
                            </div>
                            {{!-- <div class="carousel-item ">
                                <img class="w-100 h-100" src="/public/img/product-2.jpg" alt="Image">
                            </div>
                            <div class="carousel-item">
                                <img class="w-100 h-100" src="/public/img/product-3.jpg" alt="Image">
                            </div>
                            <div class="carousel-item ">
                                <img class="w-100 h-100" src="/public/img/product-4.jpg" alt="Image">
                            </div> --}}
                        </div>
                        {{!-- <a class="carousel-control-prev" href="#product-carousel" data-slide="prev">
                            <i class="fa fa-2x fa-angle-left text-dark"></i>
                        </a>
                        <a class="carousel-control-next" href="#product-carousel" data-slide="next">
                            <i class="fa fa-2x fa-angle-right text-dark"></i>
                        </a> --}}
                    </div>
                </div>
            </div>
 
            <div class="col-lg-7 h-auto mb-30">
                <div class="h-100 bg-light p-100">
                    <h3 class="container pt-3 ">{{course.name}}</h3>
                    
                    <div class="container">
                        <div class="row px-xl-1 pb-1 pt-3">
                            <div class="col-lg-12">
                                    <div class="info">      
                                        <div class="intro clearfix">
                                            <div class="attributes ">
                                                        {{!-- <li class="dataattr">
                                                            <span>Mã sản phẩm: </span>
                                                            <th href="/courses/id">{{course._id}}</th>
                                                        </li> --}}
                                                        <li class="dataattr">
                                                            <span>Tác giả: </span>
                                                            <th href="/tac-gia/138/mario-vargas-llosa">{{course.author}}</th>                                                                  
                                                        </li>
                                                        {{!-- <li class="dataattr">
                                                                <span>Dịch giả: </span>
                                                                <a href="/nhom-dich/380/ngan-xuyen">{{course.dich_gia}}</a>
                                                        </li> --}}
                                                        <li class="dataattr">
                                                                <span>Nhà xuất bản: </span>
                                                                <th href="/nha-xuat-ban/1/hoi-nha-van">{{course.nha_sx}}</th>
                                                        </li>  
                                                        <li class="dataattr">
                                                                <span>Số trang: </span>
                                                                <th href="/tac-gia/138/mario-vargas-llosa">{{course.so_trang}}</th>                                                                  
                                                        </li>  
                                                        <li class="dataattr">
                                                                <span>Kích thước: </span>
                                                                <th href="/tac-gia/138/mario-vargas-llosa">{{course.kich_thuoc}}</th>                                                                  
                                                        </li>
                                                        
                                                <div class=" container d-flex align-items-center mb-2 pt-2 ">
                                                    <div>
                                                        <h3 class="with-strike small-text1">{{course.goc}}</h3>
                                                    </div>
                                                    <p class="oldprice">
                                                        
                                                        <div class="sbuttons">
                                                            <h3 class="font-weight-semi-bold mb-2 giaText red-text" style="margin-top: 8px; margin-buttom: 8px;margin-left: 8px;">{{course.gia}} đ</h3>
                                                        </div>
                                                    </p>
                                                    
                                                </div>

                                                <div class="d-flex mb-3">
                                                    <div class="text-primary mr-2">
                                                        <small class="fas fa-star"></small>
                                                        <small class="fas fa-star"></small>
                                                        <small class="fas fa-star"></small>
                                                        <small class="fas fa-star"></small>
                                                        <small class="fas fa-star-half-alt"></small>
                                                    </div>
                                                    <small class="pt-1">(3 Reviews)</small>                  
                                                    <div data-view-id="pdp_quantity_sold" class=" px-2 styles__StyledQuantitySold-sc-1u1gph7-2 exWbxD">|  Đã bán 1948</div>                                       
                                                </div>
                                            </div>
                                        </div>              
                                </div>                       
                            </div>
                        </div>
                    </div>
                    <div class=" container d-flex align-items-center mb-4 pt-1 ">
                        {{!-- <div class="input-group quantity mr-3" style="width: 130px;">
                            <div class="input-group-btn">
                                <button class="btn btn-primary btn-minus">
                                    <i class="fa fa-minus"></i>
                                </button>
                            </div>
                            <input type="text" class="form-control bg-secondary border-0 text-center" value="1">
                            <div class="input-group-btn">
                                <button class="btn btn-primary btn-plus">
                                    <i class="fa fa-plus"></i>
                                </button>
                            </div>
                        </div> --}}
                        <button class="btn btn-primary px-3 add-to-cart" data-sach-id={{course._id}}>
                            <i class="fa fa-shopping-cart mr-1"></i> Thêm vào giỏ hàng
                        </button>
                        <div class="d-flex align-items-center mb-2 mt-2 px-3  ">                                                        
                            <a href="/courses/{{course._id}}/add_cart" class= "btn btn-primary">Mua ngay</a>
                        </div>
                    </div>
<script>
    const addToCart = document.getElementsByClassName('add-to-cart');
    console.log(addToCart);
    for (let i = 0 ; i < addToCart.length; i++) {
        console.log("1");
        addToCart[i].addEventListener('click', async () => {
        try {
            // Lấy data-sach-id từ biểu tượng giỏ hàng để biết sách cụ thể
            const cart = {
                id: addToCart[i].getAttribute('data-sach-id'),
            };
            console.log(cart);
            fetch('/cart/add_to_carts', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(cart)
            })
        } catch (error) {
            console.error('Lỗi khi xử lý sự kiện click giỏ hàng:', error);
        }
    });
    } 
</script>
                    
                    <div class=" container d-flex fVzmdH _9NlEB8">
                        <div class="vKtAFa" style="width: 200px;">
                            <div class="shopee-drawer Dp0x1X" id="pc-drawer-id-4" tabindex="0">
                                <div class="_5QD9Iy flex items-center">
                                    <img class="NmTIFU" style="width: 25px; height: 25px;" src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/6c502a2641457578b0d5f5153b53dd5d.png">
                                        <div class="mnQqkL">7 ngày miễn phí trả hàng</div>
                                </div>
                            </div>
                        </div>
                        <div class="vKtAFa" style="width: 200px;">
                            <div class="shopee-drawer Dp0x1X" id="pc-drawer-id-5" tabindex="0">
                                <div class="_5QD9Iy flex items-center">
                                    <img class="NmTIFU" style="width: 25px; height: 25px;" src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/511aca04cc3ba9234ab0e4fcf20768a2.png">
                                        <div class="mnQqkL">Hàng chính hãng 100%</div>
                                </div>
                            </div>
                        </div>
                        <div class="vKtAFa"style="width: 200px;">
                            <div class="shopee-drawer Dp0x1X" id="pc-drawer-id-6" tabindex="0">
                                <div class="_5QD9Iy flex items-center">
                                    <img class="NmTIFU" style="width: 25px; height: 25px;" src="https://deo.shopeemobile.com/shopee/shopee-pcmall-live-sg/16ead7e0a68c3cff9f32910e4be08122.png">
                                        <div class="mnQqkL">Miễn phí vận chuyển</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="row px-xl-1">
            <div class="col">
                <div class="bg-light p-30">
                    <div class="nav nav-tabs mb-4">
                        <a class="nav-item nav-link text-dark active" data-toggle="tab" href="#tab-pane-1">Giới thiệu sách</a>
                        {{!-- <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-2">Information</a> --}}
                        <a class="nav-item nav-link text-dark" data-toggle="tab" href="#tab-pane-3">Đánh giá</a>
                    </div>
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="tab-pane-1">
                            {{!-- <h4 class="mb-3">Product Description</h4> --}}
                            <p>{{course.description}}</p>
                        </div>
                        <div class="tab-pane fade" id="tab-pane-3">
                            <div class="row ">
                                <div class=" col-md-6" id="review-container">
                                    <h4 class="mb-4">Các đánh giá cho "{{course.name}}"</h4>
                                    {{#each reviews}}
                                    <div class="media mb-4">
                                        <img src="/public/img/user.jpg" alt="Image" class="avatar-img img-fluid mr-3 mt-1" style="width: 45px;">
                                        <div class="media-body">
                                            <h6>{{this.fullName}}</h6>
                                            <div class="text-primary mb-2">
                                                {{!-- {{this.rating}} --}}
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                                    <i class="fas fa-star"></i>
                                            </div>
                                            <p>{{this.message}}</p>
                                        </div>
                                    </div>
                                    {{/each}}
                                    <div class="media mb-4">
                                        <img src="/public/img/user.jpg" alt="Image" class="avatar-img img-fluid mr-3 mt-1" style="width: 45px;">
                                        <div class="media-body">
                                            <h6>Bảo Uyên<small> - <i>01 Jan 2022</i></small></h6>
                                            <div class="text-primary mb-2">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>                                          
                                            </div>
                                            <p>Sách mang lại nhiều bài học cho cuộc sống.</p>
                                            <p>Đóng gói cẩn thận, giao hàng nhanh chóng</p>
                                        </div>
                                    </div>
                                    <div class="media mb-4">
                                        <img src="/public/img/user.jpg" alt="Image" class="avatar-img img-fluid mr-3 mt-1" style="width: 45px;">
                                        <div class="media-body">
                                            <h6>Thanh Hải<small> - <i>06 August 2022</i></small></h6>
                                            <div class="text-primary mb-2">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="far fa-star"></i>                                          
                                            </div>
                                            <p>Một cuốn sách hay đáng để đọc và ý nghĩa dành cho các bạn trẻ .</p>
                                    
                                        </div>
                                    </div>
                                    <div class="media mb-4">
                                        <img src="/public/img/user.jpg" alt="Image" class="avatar-img img-fluid mr-3 mt-1" style="width: 45px;">
                                        <div class="media-body">
                                            <h6>Lan Hương<small> - <i>15 Dec 2021</i></small></h6>
                                            <div class="text-primary mb-2">
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>
                                                <i class="fas fa-star"></i>                                          
                                            </div>
                                            <p>Tôi đã mua sách này.</p>
                                            <p>Sách hay có kèm bookmark, giấy dày 👍👍</p>
                                        </div>
                                    </div>
                                </div>


                                <div id="review-success" class="d-none">
                                    <p class="text-success">Đánh giá của bạn đã được gửi thành công!</p>
                                </div>
                                <form id="review-form" action="/review/add-review" method="POST">
                                    <div class="container" >
                                        <h4 >Để lại đánh giá</h4>                                   

                                        <div class="d-flex my-3">
                                            <p class="mb-0 mr-2">Chất lượng sách :</p>
                                            <div class="rating-stars">
                                                <i class="star far fa-star" data-rating="1"></i>
                                                <i class="star far fa-star" data-rating="2"></i>
                                                <i class="star far fa-star" data-rating="3"></i>
                                                <i class="star far fa-star" data-rating="4"></i>
                                                <i class="star far fa-star" data-rating="5"></i>
                                                <input type="hidden" id="rating-input" name="rating" value="0">
                                            </div>
                                        </div>
                                        {{!-- xử lý click ngôi sao --}}
                                        <script>
                                            const stars = document.querySelectorAll('.star');
                                            const ratingInput = document.getElementById('rating-input');

                                            stars.forEach(star => {
                                                star.addEventListener('click', function() {
                                                    const rating = parseInt(this.getAttribute('data-rating'));
                                                    ratingInput.value = rating;
                                                    updateStars(rating);
                                                });
                                            });

                                            function updateStars(selectedRating) {
                                                stars.forEach(star => {
                                                    const rating = parseInt(star.getAttribute('data-rating'));
                                                    if (rating <= selectedRating) {
                                                        star.classList.remove('far');
                                                        star.classList.add('fas');
                                                    } else {
                                                        star.classList.remove('fas');
                                                        star.classList.add('far');
                                                    }
                                                });
                                            }

                                        </script>
                                            <div class="form-group">
                                                <label>Tên của bạn </label>
                                                <input type="text" class="form-control" name="fullName" id="fullNameInput">
                                            </div>
                                            <div class="form-group">
                                                <label>Đánh giá của bạn </label>
                                                <textarea type="text" id="messageInput" name="message" cols="30" rows="5" class="form-control"></textarea>
                                            </div>
                                            {{!-- 
                                            <div class="form-group">
                                                <label for="email"> Email của bạn </label>
                                                <input type="email" class="form-control" id="email">
                                            </div> --}} 
                                            {{!-- <div class="form-group mb-0">
                                                <input type="submit" value="Gửi đánh giá" class="btn btn-primary px-3" id="submit-review">
                                            </div> --}}
                                            <button type="button" id="add-review-button" data-sach-id={{course._id}}  class="btn btn-block btn-primary font-weight-bold py-3 ">Gửi đánh giá</button>
                                            <div id="error-message" class="text-danger"></div>
                                       

                                            </script>
                                        {{!-- click đánh giá --}}
                                        <script>
                                            const addReviewButton = document.getElementById('add-review-button');

                                            addReviewButton.addEventListener('click', () => {
                                                // Lấy dữ liệu từ form
                                                const rating = document.getElementById('rating-input').value;
                                                const fullName = document.getElementById('fullNameInput').value;
                                                const message = document.getElementById('messageInput').value;
                                                const courseid = addReviewButton.getAttribute('data-sach-id');
                                                
                                                if (rating === '0' || fullName === '' || message === '') {
                                                    alert('Vui lòng điền đầy đủ thông tin đánh giá');
                                                    {{!-- document.getElementById('error-message').innerText = 'Vui lòng nhập đầy đủ thông tin đánh giá sách.'; --}}
                                                    return; 
                                                }
                                                // Tạo một đối tượng dữ liệu FormData
                                                const formData = {
                                                    "rating": rating,
                                                    "fullName": fullName, 
                                                    "message": message,
                                                    "courseId": courseid
                                                }
                                                // Gửi dữ liệu đánh giá lên server
                                                console.log(formData, 'formData');
                                                fetch('/review/add-review', {
                                                    method: 'POST',
                                                    headers: {
                                                        'Content-Type': 'application/json'
                                                    },
                                                    body: JSON.stringify(formData)
                                                })
                                                .then(response => response.text())
                                                .then(data => {
                                                    alert("Gửi đánh giá");
                                                    {{!-- location.reload(); --}}
                                                })
                                                .catch(error => {
                                                    console.error('Lỗi: ' + error);
                                                });
                                            });
                                        </script>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


<!-- Thêm phần hiển thị sách cùng tác giả -->
<div class="container">
    {{#if authorBooks.length}}
    <h3 class="section-title position-relative text-uppercase mx-xl-5 mb-4"><span class="bg-secondary pr-3">Các Sách Cùng Tác Giả</span></h3>
    <div class="row">
        {{#each authorBooks}}
        <div class="col-sm-6 col-lg-3 col-md-4 pb-1">
            <div class="product-item bg-light mb-4">
                <div class="product-img position-relative overflow-hidden">
                    <a href="/courses/{{this.slug}}">
                        <img src="{{this.image}}" class="img-fluid w-100 pt-3" alt="{{this.name}}" class="imageInput">
                        <div class="product-action">
                            <a class="btn btn-outline-dark btn-square add-to-cart" href="" data-sach-id="{{this._id}}"><i class="fa fa-shopping-cart"></i></a>
                            <a class="btn btn-outline-dark btn-square heart-icon" href="" data-sach-id="{{this._id}}"><i class="far fa-heart "></i></a>
                        </div>
                    </a>
                </div>
                <div class="text-center py-1">
                    <div class="card-body">
                        <div class="h6 text-decoration-none text-truncate nameInput">
                            <a href="/courses/{{this.slug}}">{{this.name}}</a>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mt-2">
                            <p class="card-text giaText">{{this.gia}} đ</p>
                        </div>
                        <div class="d-flex align-items-center justify-content-center mt-2">
                            <a href="/courses/{{this._id}}/add_cart" class="btn btn-primary">Mua ngay</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {{/each}}
    {{/if}}
    </div>
</div>

                                {{!-- Định dạng giá tiền --}}
                                <script>
                                        // Chọn tất cả các phần tử có lớp "giaText"
                                    const giaElements = document.querySelectorAll('.giaText');

                                    // Lặp qua tất cả các phần tử và áp dụng định dạng
                                    giaElements.forEach(element => {
                                        const giaTuMongoDB = parseFloat(element.textContent);
                                        const giaDaDinhDang = giaTuMongoDB.toLocaleString('vi-VN');
                                        element.textContent = giaDaDinhDang + ' đ';
                                    });

                                </script> 
{{!-- {{/if}} --}}
